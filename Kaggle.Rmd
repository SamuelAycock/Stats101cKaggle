---
title: "Kaggle Project"
author: "Samuel Aycock and Kendrick Brayman"
date: "November 21, 2019"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r}
#Read the data.
library(glmnet)
library(leaps)
library(caret)
library(MASS)
library(splines)
library(gam)
data  <- read.csv("basketball.csv")
head(data)
```

```{r}
# Visting Team corr (1).
DF <- data[,c(3,4:80)]
DF[] <- lapply(DF,as.integer)
cor(DF)[,1][c(order(cor(DF)[,1]))]
```

```{r}
# Visiting team corr (2).
DF <- data[,c(3,81:112)]
DF[] <- lapply(DF,as.integer)
cor(DF)[,1][c(order(cor(DF)[,1]))]
```

```{r}
# Home team corr (1).
DF <- data[,c(3,115:180)]
DF[] <- lapply(DF,as.integer)
cor(DF)[,1][c(order(cor(DF)[,1]))]
```

```{r}
# Home team corr (2).
DF <- data[,c(3,181:205)]
DF[] <- lapply(DF,as.integer)
cor(DF)[,1][c(order(cor(DF)[,1]))]
```

```{r}
# Home team corr (3).
DF <- data[,c(3,206:216)]
DF[] <- lapply(DF,as.integer)
cor(DF)[,1][c(order(cor(DF)[,1]))]
```

```{r}
#Split the data
set.seed(200)
train <- sample(1:dim(data)[1], dim(data)[1]/2)
test <- -train
data_train<- data[train, ]
data_test <- data[test, ]
```

```{r}
#Lasso
training <- model.matrix(HTWins ~ HT.OS4.plmin + HT.OS5.plmin + HT.S5.plmin + HT.S4.plmin + HT.OS1.plmin + HT.OS3.plmin + HT.OS2.plmin + HT.TA.ast + HT.TA.pts + HT.TA.fgm + HT.OTS.pts + HT.OTS.ast + HT.TA.dreb + HT.OTS.dreb + HT.OTA.pts + HT.TS.pts + HT.OTA.ast + HT.S2.plmin + HT.S3.plmin + HT.S1.plmin + HT.TS.dreb + HT.OTA.fgm + HT.S1.pts + HT.TS.ast , data = data_train)

testing <- model.matrix(HTWins ~ HT.OS4.plmin + HT.OS5.plmin + HT.S5.plmin + HT.S4.plmin + HT.OS1.plmin + HT.OS3.plmin + HT.OS2.plmin + HT.TA.ast + HT.TA.pts + HT.TA.fgm + HT.OTS.pts + HT.OTS.ast + HT.TA.dreb + HT.OTS.dreb + HT.OTA.pts + HT.TS.pts + HT.OTA.ast + HT.S2.plmin + HT.S3.plmin + HT.S1.plmin + HT.TS.dreb + HT.OTA.fgm + HT.S1.pts + HT.TS.ast, data = data_test)

grid <- 10^seq(8, -2, length = 100)
fit2 <- glmnet(training, data_train$HTWins, alpha = 1, lambda = grid , thresh = 1e-12,family = "binomial")
cv2 <- cv.glmnet(training, data_train$HTWins, alpha = 1, lambda = grid, thresh = 1e-12,family = "binomial")
lambda2 <- cv2$lambda.min
lasso <- predict(fit2, s = lambda2, newx = testing)
TestMSE3 <- mean((lasso - data_test$HTWins)^2)
predict(fit2, s = lambda2, type = "coefficients")
```

```{r}
#Ridge
fit <- glmnet(training, data_train$HTWins, alpha = 0, lambda = grid, thresh = 1e-12, family = "binomial")
cv <- cv.glmnet(training, data_train$HTWins, alpha = 0, lambda = grid, thresh = 1e-12, family = "binomial")
lambda <- cv$lambda.min
ridge <- predict(fit, s = lambda, newx = testing)
TestMSE2 <- mean((ridge - data_test$HTWins)^2)
```


```{r}
#Regsubsets
HTdata <- data[,c(3,115:217)]
dataset_part <- sample(1:3, nrow(HTdata), replace = T, prob = c(0.5, 0.25, 0.25))

p <- ncol(HTdata) - 1
reg1 <- regsubsets(HTWins ~ ., data = HTdata[dataset_part == 1, ], nvmax = p, method = "forward")
reg2 <- regsubsets(HTWins ~ ., data = HTdata[dataset_part == 1, ], nvmax = p, method = "backward")
#print(summary(reg))

coefi <- coef(reg1, id = 30)
names(coefi)

coefi <- coef(reg2, id = 30)
names(coefi)
```

```{r}
#Model the data.
m1 <- glm(HTWins ~ HT.TS.tpm  +  HT.TS.tpa  +  HT.TS.stl  +  HT.TS.blk  +  HT.TS.pts  +  HT.TA.oreb +  HT.TA.dreb +  HT.TA.ast  + HT.TA.pts +   HT.OTS.tpa  + HT.OTA.dreb + HT.OTA.ast  + HT.S1.plmin + HT.S1.pts   + HT.S1.ast +   HT.S2.min + HT.S2.ast + HT.S3.plmin + HT.S3.pts + HT.S3.ast + HT.S4.pts +   HT.S4.ast +   HT.OS1.plmin + HT.OS1.fgm +  HT.OS2.fgm +  HT.OS3.plmin + HT.OS3.dreb +  HT.OS3.to  +  HT.OS3.oreb  + HT.OS4.plmin, family = "binomial",data = data_train)
summary(m1)
anova(m1)
```

```{r}
#Model
M1 <- train(HTWins ~ HT.TS.tpm  +  HT.TS.tpa  +  HT.TS.stl  +  HT.TS.blk  +  HT.TS.pts  +  HT.TA.oreb +  HT.TA.dreb +  HT.TA.ast  + HT.TA.pts +   HT.OTS.tpa  + HT.OTA.dreb + HT.OTA.ast  + HT.S1.plmin + HT.S1.pts   + HT.S1.ast +   HT.S2.min + HT.S2.ast + HT.S3.plmin + HT.S3.pts + HT.S3.ast + HT.S4.pts +   HT.S4.ast +   HT.OS1.plmin + HT.OS1.fgm +  HT.OS2.fgm +  HT.OS3.plmin + HT.OS3.dreb +  HT.OS3.to  +  HT.OS3.oreb  + HT.OS4.plmin, method = "glm",data = data)

summary(M1)
#confusionMatrix(table(predict(M1)), data_train$HTWins == "Yes")
```

```{r}
#Model the data.
m2 <- glm(HTWins ~ HT.TS.tpm  +  HT.TS.stl  +  HT.TS.blk  +  HT.TS.pts  +  HT.TA.oreb +  HT.TA.ast  +  HT.TA.pts  +  HT.OTS.fga + HT.OTS.tpm  + HT.OTS.tpa  + HT.OTS.fta  + HT.OTS.pts  + HT.OTA.pts  + HT.S1.plmin + HT.S1.pts + HT.S1.ast   + HT.S2.min + HT.S2.ast + HT.S3.ast   + HT.S4.pts + HT.S4.ast +   HT.OS1.plmin + HT.OS1.dreb  + HT.OS1.fgm  + HT.OS2.oreb +  HT.OS3.dreb + HT.OS3.to  +  HT.OS4.oreb  + HT.OS5.fgm  + HT.OS5.oreb, family = "binomial",data = data_train)
summary(m1)
anova(m1)
```

```{r}
#Model
M2 <- train(HTWins ~ HT.TS.tpm  +  HT.TS.stl  +  HT.TS.blk  +  HT.TS.pts  +  HT.TA.oreb +  HT.TA.ast  +  HT.TA.pts  +  HT.OTS.fga + HT.OTS.tpm  + HT.OTS.tpa  + HT.OTS.fta  + HT.OTS.pts  + HT.OTA.pts  + HT.S1.plmin + HT.S1.pts + HT.S1.ast   + HT.S2.min + HT.S2.ast + HT.S3.ast   + HT.S4.pts + HT.S4.ast +   HT.OS1.plmin + HT.OS1.dreb  + HT.OS1.fgm  + HT.OS2.oreb +  HT.OS3.dreb + HT.OS3.to  +  HT.OS4.oreb  + HT.OS5.fgm  + HT.OS5.oreb, method = "glm",data = data)

summary(M1)
#confusionMatrix(table(predict(M1)), data_train$HTWins == "Yes")
```


```{r}
#Test the model with the split training data first.
Wins <- factor(c("Yes","No"))
Winpreds <- predict(m1,newdata = data_test,"response")
HTWinspred <- rep(Wins[2], dim(testing)[1])
HTWinspred[Winpreds > .5] <- Wins[1]
confusionmat <- table(HTWinspred, data_test$HTWins)
Accuracy <- (confusionmat[1] + confusionmat[4])/sum(confusionmat)
print(Accuracy)
```


```{r}
#Now test the model on the test data.
testing <- read.csv("basketballtest.csv")

Winpreds <- predict(m1,newdata = testing,"response")
HTWins <- rep(Wins[2], dim(testing)[1])
HTWins[Winpreds > .5] <- Wins[1]

#Save the predictions.
Upload <- data.frame("id" = testing$id,HTWins)
write.csv(Upload,'C:/Users/sama2/OneDrive/Documents/Upload3.csv',row.names = FALSE)
```




